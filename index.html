<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' https://*.alchemy.com https://api.coingecko.com https://api.cultdao.io https://api.github.com; script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline' 'unsafe-eval'; style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; font-src https://fonts.gstatic.com;"> 
   <title>CULT DAO | HUB</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js" type="application/javascript"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/dao.css">
</head>
<body>

    <div id="custom-alert-overlay">
        <div class="custom-alert-modal">
            <p id="custom-alert-message"></p>
            <button id="custom-alert-close" class="btn">Close</button>
        </div>
    </div>
    <div id="disclaimer-overlay">
        <div class="disclaimer-modal">
            <h4>DISCLAIMER: USE AT OWN RISK</h4>
            <p>This application is in a very early pre-alpha stage. USE CAUTIOUSLY. Users may encounter bugs, incomplete functionalities, and potential vulnerabilities. Your feedback is valuable to us as we continue to improve and stabilize the platform. THIS IS NOT the official CultDAO site.</p>
            <p>This project is a community build. View the code on <a href="https://github.com/wearecultdao/hub" target="_blank" rel="noopener noreferrer">GitHub</a>.</p>
            <div class="button-group" style="justify-content: center; margin-top: 20px;">
                <button id="accept-disclaimer-btn" class="btn">I acknowledge and accept full responsibility for its use.</button>
            </div>
        </div>
    </div>
    <div class="container">
        <header class="header">
            <h1>CULT DAO</h1>
            <div class="header-actions">
				<button id="shuffle-theme-btn" class="btn">Shuffle Experience</button>
                <button id="theme-toggle" class="btn">Switch Mood</button>
                <div id="currency-widget" class="currency-widget" style="display: none;">
                    <button id="currency-selector-btn" class="btn">USD</button>
                    <div id="currency-dropdown" class="wallet-dropdown">
                        <!-- Options will be populated by app.js -->
                    </div>
                </div>
                <div class="wallet-widget">
                    <button id="connect-wallet-btn" class="btn">Connect Wallet</button>
                    <div id="wallet-dropdown" class="wallet-dropdown">
                        <button id="copy-address-btn" class="dropdown-item">Copy Address</button>
                        <a id="etherscan-link" href="#" target="_blank" rel="noopener noreferrer" class="dropdown-item">View on Etherscan</a>
                        <button id="disconnect-btn" class="dropdown-item">Disconnect</button>
                    </div>
                </div>
            </div>
        </header>
        <div id="reminder-banner" style="display: none;">
            <p>Remember: This is a community-built tool. Use at your own risk. (Latest update: <span id="repo-update-date">...</span>)</p>
            <button id="close-reminder-btn">×</button>
        </div>
        <main id="dapp-content" class="dapp-content">
            <!-- Wallet Section (Always Open) -->
            <section class="ui-section">
                <div class="info-grid">
                    <div class="info-item"><h3>Wallet</h3><span id="wallet-address" class="value">...</span></div>
                    <div class="info-item"><h3>Delegation Status</h3><span id="delegation-status" class="value">...</span></div>
                    <div class="info-item"><h3 id="rights-label">Your Rights</h3><span id="proposal-rights" class="value">...</span></div>
                    <div class="info-item"><h3>Your CULT</h3><span id="cult-balance" class="value">0.00</span></div>
                    <div class="info-item"><h3>Your dCULT</h3><span id="dcult-balance" class="value">0.00</span></div>
					<div class="info-item"><h3>Combined CULT Holdings</h3><span id="total-cult-holdings" class="value">...</span></div>
					<div class="info-item"><h3 id="total-cult-value-label">Total Value</h3><span id="total-cult-value" class="value">...</span></div>
					<div class="info-item"><h3>Guardian Threshold</h3><span id="top50staker" class="value">...</span></div>
                </div>
                <div id="delegate-section" class="button-group" style="display: none;">
                    <button id="delegate-btn" class="btn">Delegate (TX)</button>
                    <button id="sign-delegation-btn" class="btn" style="border-style: dashed;">Delegate (Sig)</button>
                    <button id="push-delegates-btn" class="btn">Push <span id="delegate-counter">0</span> Delegates</button>
                    <p id="top50-notice" class="eligibility-notice" style="margin-top: 12; width: 100%;"></p>
                </div>
            </section>

            <!-- CORRECTED SECTION ORDER & COLLAPSED STATE -->
            <details id="details-tracked-wallets">
                <summary><h2>Track Your Wallets</h2></summary>
                <section class="ui-section" style="margin-top: 1rem;">
                    <h4>Combined Tracked Wallets</h4>
                    <div class="info-grid" id="combined-tracked-wallets-info">
                        <div class="info-item"><h3>Combined CULT</h3><span id="combined-tracked-cult" class="value">0.00</span></div>
                        <div class="info-item"><h3>Combined dCULT</h3><span id="combined-tracked-dcult" class="value">0.00</span></div>
                        <div class="info-item"><h3>Combined Holdings</h3><span id="combined-tracked-total" class="value">0.00</span></div>
                        <div class="info-item"><h3 id="combined-tracked-value-label">Combined Value</h3><span id="combined-tracked-value" class="value">...</span></div>
                    </div>
                     <hr style="border-color: var(--color-border-stroke); opacity: 0.2; margin: 30px 0;">
                       <div class="form-group full-width">
                        <label for="track-wallet-input">Add Wallet(s) to Track</label>
                        <div class="input-with-button">
                            <input type="text" id="track-wallet-input" placeholder="0x... or ENS name. Seperated by ;">
                            <button id="add-tracked-wallet-btn" class="btn-max">Add</button>
                        </div>
                        <small style="opacity: 0.7; margin-top: 5px; display: block;">Add multiple wallets to view your combined holdings. </small>
                    </div>
                    <div class="input-with-button">
                      <div class="button-group" style="margin-bottom: 20px;">
                        <button id="clear-tracked-wallets-btn" class="btn" style="display: none;">Clear All Tracked Wallets</button>
                      </div>
                    </div>
                    <div id="tracked-wallets-list">
                        <p style="text-align: center; opacity: 0.6; padding: 20px;">No wallets being tracked yet.</p>
                    </div>
                </section>
            </details>
            
            <details id="details-staking">
                <summary><h2>Staking & Returns</h2></summary>
                <section class="ui-section" style="margin-top: 1rem;">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <div class="label-line">
                                <label for="stake-amount">Amount of CULT to Stake</label>
                                <p class="available-balance" id="available-cult">Available: 0.0</p>
                            </div>
                            <div class="input-with-button">
                                <input type="text" id="stake-amount" placeholder="0.0">
                                <button id="stake-max-btn" class="btn-max">Max</button>
                            </div>
                            <div class="button-group" style="margin-top: 10px;"><button id="stake-btn" class="btn">Stake</button></div>
                        </div>
                         <div class="form-group full-width">
                            <div class="label-line">
                                <label for="unstake-amount">Amount of dCULT to Unstake</label>
                                <p class="available-balance" id="available-dcult">Available: 0.0</p>
                            </div>
                            <div class="input-with-button">
                                <input type="text" id="unstake-amount" placeholder="0.0">
                                <button id="unstake-max-btn" class="btn-max">Max</button>
                            </div>
                            <div class="button-group" style="margin-top: 10px;"><button id="unstake-btn" class="btn">Unstake</button></div>
                        </div>
                    </div>
                    <hr style="border-color: var(--color-border-stroke); opacity: 0.2; margin: 30px 0;">
                    <div class="form-group">
                        <label>Claimable CULT from Your DAO Investments</label>
                        <div class="info-box" style="margin-top: 10px;">
                            <span id="claimable-rewards" class="value">0.00</span>
                        </div>
                    </div>
                    <div class="button-group">
                        <button id="claim-rewards-btn" class="btn" style="display: none;">Claim Your Rewards</button>
                    </div>
                </section>
            </details>

            <details id="details-active-proposals">
                <summary><h2>Active Proposals</h2></summary>
                <section class="ui-section proposal-list" id="active-proposal-list" style="margin-top: 1rem;">
                    <p>...</p>
                </section>
            </details>  

            <details id="details-dao-metrics">
                <summary><h2>DAO Metrics</h2></summary>
                <section class="ui-section" id="dao-metrics-section" style="margin-top: 1rem;">
                    <h4>Proposals Stats</h4>
                    <div class="info-row">
                        <div class="info-item"><h3>Active Proposals</h3><span id="metric-active-proposals" class="value">...</span></div>
                        <div class="info-item"><h3>Passed Proposals</h3><span id="metric-passed-proposals" class="value">...</span></div>
                        <div class="info-item"><h3>Defeated Proposals</h3><span id="metric-defeated-proposals" class="value">...</span></div>
                        <div class="info-item"><h3>Executed Proposals</h3><span id="metric-executed-proposals" class="value">...</span></div>
                        <div class="info-item"><h3>Cancelled after Passing</h3><span id="metric-skipped-passed-proposals" class="value">...</span></div>
                        <div class="info-item"><h3>Total Cancelled Proposals</h3><span id="metric-cancelled-proposals" class="value">...</span></div>
                        <div class="info-item"><h3>Total Proposals</h3><span id="metric-total-proposals" class="value">...</span></div>
                    </div>
                    <hr style="border-color: var(--color-border-stroke); opacity: 0.2; margin: 30px 0;">
                    <h4>Supply Stats</h4>
                    <div class="info-row">
                        <div class="info-item"><h3>Total CULT Supply</h3><span id="metric-cult-supply" class="value">...</span></div>
                        <div class="info-item"><h3>Burned CULT</h3><span id="metric-cult-burned" class="value">...</span></div>
                        <div class="info-item"><h3>Burned %</h3><span id="metric-cult-burned-percent" class="value">...</span><div class="minibar"><div class="fill" id="bar-burned"></div></div></div>
                        <div class="info-item"><h3>Circulating Supply</h3><span id="metric-cult-circulating" class="value">...</span></div>
                        <div class="info-item"><h3>Circulating %</h3><span id="metric-cult-circulating-percent" class="value">...</span><div class="minibar"><div class="fill" id="bar-circulating"></div></div></div>
                        <div class="info-item"><h3>Staked CULT</h3><span id="metric-cult-staked" class="value">...</span></div>
                        <div class="info-item"><h3 id="metric-staked-value-label">Staked CULT Value</h3><span id="metric-staked-value" class="value">...</span></div>
                        <div class="info-item"><h3>Staked CULT %</h3><span id="metric-staked-percent" class="value">...</span><div class="minibar"><div class="fill" id="bar-staked"></div></div></div>
                        <div class="info-item"><h3>Staked vs Circ. Supply</h3><span id="metric-staked-vs-circ-percent" class="value">...</span><div class="minibar"><div class="fill" id="bar-staked-vs-circ"></div></div></div>
                    </div>
                    <hr style="border-color: var(--color-border-stroke); opacity: 0.2; margin: 30px 0;">
                    <h4>Treasury Stats</h4>
                    <div class="info-row justify-start"> 
                        <div class="info-item"><h3>Treasury CULT</h3><span id="metric-treasury-cult" class="value">...</span></div>
                        <div class="info-item"><h3>Treasury Value (ETH)</h3><span id="metric-treasury-value-eth" class="value">...</span></div>
                        <div class="info-item"><h3 id="metric-treasury-value-label">Treasury Value</h3><span id="metric-treasury-value" class="value">...</span></div>
                    </div>
                    <hr style="border-color: var(--color-border-stroke) dashed; opacity: 0.2; margin: 30px 0;">
                    <div class="info-row justify-start">
                        <div class="info-item"><h3>ETH Sent to Burn</h3><span id="metric-eth-burned" class="value">...</span></div>
                        <div class="info-item"><h3>ETH Sent to Investees</h3><span id="metric-eth-funded" class="value">...</span></div>
                        <div class="info-item"><h3>Total ETH Disbursed</h3><span id="metric-eth-total-disbursed" class="value">...</span></div> 
                    </div>
                    <hr style="border-color: var(--color-border-stroke); opacity: 0.2; margin: 30px 0;">
                    <h4>Pool Stats</h4>
                    <div class="info-row">
                        <div class="info-item"><h3 id="metric-cult-price-label">CULT Price</h3><span id="metric-cult-price" class="value">...</span></div>
                        <div class="info-item"><h3>Pooled CULT</h3><span id="metric-cult-lp" class="value">...</span></div>
                        <div class="info-item"><h3>Pooled ETH</h3><span id="metric-eth-lp" class="value">...</span></div>
                        <div class="info-item"><h3 id="metric-liquidity-label">Liquidity</h3><span id="metric-liquidity" class="value">...</span></div>
                        <div class="info-item"><h3 id="metric-mcap-label">Market Cap</h3><span id="metric-mcap" class="value">...</span></div>
                        <div class="info-item"><h3>Liquidity/Marketcap</h3><span id="metric-liq-mcap" class="value">...</span></div>
                        <div class="info-item"><h3>% Liquidity locked</h3><span id="metric-locked-liq" class="value">...</span></div>
                        <div class="info-item"><h3>Liq. locked until</h3><span id="metric-unlock-liq" class="value">...</span></div>
                        <div class="info-item"><h3>ETH/CULT Price</h3><span id="metric-eth-price-cult" class="value">...</span></div>
                        <div class="info-item"><h3>CULT/ETH Price</h3><span id="metric-cult-price-eth" class="value">...</span></div>
                        <div class="info-item"><h3>% of Total Supply in LP</h3><span id="metric-lp-percent-total" class="value">...</span><div class="minibar"><div class="fill" id="bar-lp-percent-total"></div></div></div>
                        <div class="info-item"><h3>% of Circulating Supply in LP</h3><span id="metric-lp-percent-circ" class="value">...</span><div class="minibar"><div class="fill" id="bar-lp-percent-circ"></div></div></div>
                    </div>
                </section>
            </details>
            
            <details id="details-submit-proposal">
                <summary><h2>Submit a New Proposal</h2></summary>
                <section class="ui-section" id="submit-proposal-section" style="margin-top: 1rem;">
                    <div id="proposal-form-fields">
                        <div class="form-grid">
                            <div class="form-group"><label for="p-projectName">Project Name (Mandatory)</label><input type="text" id="p-projectName" placeholder="e.g., Awesome Project"></div>
                            <div class="form-group"><label for="p-investeeWallet">Investee Wallet (Mandatory)</label><input type="text" id="p-investeeWallet" placeholder="0x..."></div>
                            <div class="form-group full-width"><label for="p-shortDescription">Short Description (Mandatory)</label><textarea id="p-shortDescription"></textarea></div>
                            <div class="form-group"><label for="p-socialChannel">Socials (Linktree, Twitter, etc)</label><input type="text" id="p-socialChannel" placeholder="https://..."></div>
                            <div class="form-group"><label for="p-links">Docs/Website Links</label><input type="text" id="p-links" placeholder="https://..."></div>
                            <div class="form-group full-width"><label for="p-manifestoOutlinedFit">How does this fit the manifesto?</label><textarea id="p-manifestoOutlinedFit"></textarea></div>
                        </div>
                        <details>
                            <summary class="advanced-options-summary">Show Advanced Options</summary>
                            <div class="form-grid" style="margin-top: 20px;">
                                <div class="form-group"><label>Proposer's Wallet</label><div id="p-proposerWallet" class="value" style="padding: 12px; background: rgba(0,0,0,0.2); border: 1px solid var(--color-border); border-radius: 4px; min-height: 45px; display:flex; align-items:center;"></div></div>
                                 <div class="form-group"><label for="p-returnModel">Return Model</label><input type="text" id="p-returnModel" placeholder="e.g., 0.4% of token supply"></div>
                                <div class="form-group full-width"><label for="p-proposedTimeline">Proposed Timeline</label><textarea id="p-proposedTimeline" placeholder="e.g., Q1: Launch, Q2: Feature X..."></textarea></div>
                                <div class="form-group full-width"><label for="p-fundsStoredHeldUtilised">How will funds be stored/utilised?</label><textarea id="p-fundsStoredHeldUtilised" placeholder="e.g., 50% Multisig, 50% operations..."></textarea></div>
                            </div>
                        </details>
                    </div>
                    <div class="button-group" style="margin-top: 20px;">
                        <button id="submit-proposal-btn" class="btn">Submit Proposal</button>
                    </div>
                    <p id="proposal-eligibility-notice" class="eligibility-notice"></p>
                </section>
            </details>
           
            <details id="details-past-proposals">
                <summary><h2>Past Proposals</h2></summary>
                <section class="ui-section" style="margin-top: 1rem;">
                     <div class="form-group">
                        <label for="search-proposals">Search Past Proposals</label>
                        <input type="text" id="search-proposals" placeholder="Search by ID, Proposer Address, or any keyword...">
                    </div>
                    <div class="filter-group">
                        <label><input type="checkbox" id="filter-executed"> Show Executed Only</label>
                        <label><input type="checkbox" id="filter-defeated"> Show Defeated Only</label>
                        <label><input type="checkbox" id="filter-hide-cancelled"> Hide Cancelled</label>
                    </div>
                    <div class="proposal-list" id="past-proposal-list">
                        <p>...</p>
                    </div>
                    <div class="button-group" style="justify-content: center; margin-top: 20px;">
                        <button id="load-more-btn" class="btn" style="display: none;">Load Older Proposals</button>
                    </div>
                </section>
            </details>
        </main>
    </div>

    <template id="proposal-template">
        <div class="proposal">
            <div class="proposal-title">
                <h3 class="proposal-name-title"></h3>
                <span class="proposal-status"></span>
            </div>
    
            <div class="proposal-timer-container" style="margin-top: 0px; margin-bottom: 8px; display: none; align-items: center;">
                <span style="opacity: 0.7; margin-right: 6px; font-size: 0.9rem;">Ends in:</span>
                <span class="proposal-timer" style="font-family: var(--font-mono); color: var(--color-green); font-size: 0.9rem;">...</span>
            </div>
    
            <div class="button-group" style="margin-top: 12px;">
                <button class="btn-expand view-details-btn">Show Details ▼</button>
            </div>
            
            <div class="proposal-details" style="display: none;">
                <div class="details-section" style="margin-top:20px">
                    <div class="details-grid">
                        <div class="details-item"><strong>For Votes:</strong><br><span class="prop-for-votes"></span></div>
                        <div class="details-item"><strong>Against Votes:</strong><br><span class="prop-against-votes"></span></div>
                        <div class="details-item"><strong>Total Votes:</strong><br><span class="prop-total-votes"></span></div>
                        <div class="details-item"><strong>Proposer:</strong><br><span class="prop-proposer"></span></div>
                        <div class="details-item"><strong>Start Block:</strong><br><span class="prop-start-block"></span></div>
                        <div class="details-item"><strong>End Block:</strong><br><span class="prop-end-block"></span></div>
                        <div class="details-item"><strong>ETA:</strong><br><span class="prop-eta"></span></div>
                        <div class="details-item prop-execution-tx" style="display: none;"><strong>Execution TX:</strong><br><span class="prop-execution-tx-link"></span></div>
                        <div class="details-item prop-funding-tx" style="display: none;"><strong>Payment TX:</strong><br><span class="prop-funding-tx-link"></span></div>
                    </div>
                </div>
                <div class="details-section prop-description-container"></div>
                <div class="proposal-actions-container"></div>
                <details>
                    <summary class="advanced-options-summary">Technical Data</summary>
                    <div class="details-section prop-technical-data"></div>
                </details>
            </div>
        </div>
    </template>

    <script type="module" src="contracts.js"></script>
    <script type="module" src="app.js"></script>
    <script>
      const root = document.documentElement;
      const themeToggleBtn = document.getElementById('theme-toggle');
      let isPublishTheme = true;
      function applyTheme(theme) {
        if (theme === 'publish') {
          root.style.setProperty('--background-image', 'radial-gradient(circle, #ff5252, black');
          root.style.setProperty('--btn-bg', '#333333');
          root.style.setProperty('--wallet-dropdown-bg', '#050505');
          root.style.setProperty('--ui-section-blur', 'blur(0px)');
          root.style.setProperty('--theme-name', 'publish');
        } else {
          root.style.setProperty('--background-image', 'radial-gradient(circle, #222222, black)');
          root.style.setProperty('--btn-bg', '#ff5252');
          root.style.setProperty('--wallet-dropdown-bg', '#ff5252');
          root.style.setProperty('--ui-section-blur', 'blur(0px)');
          root.style.setProperty('--theme-name', 'default');
        }
      }
      themeToggleBtn.addEventListener('click', () => {
        isPublishTheme = !isPublishTheme;
        applyTheme(isPublishTheme ? 'publish' : 'default');
      });
      applyTheme('publish');
      const shuffleBtn = document.getElementById('shuffle-theme-btn');
      function getRandomColor() {
        const letters = '0123456789ABCDEF';
        let color = '#';
        for (let i = 0; i < 6; i++) {
          color += letters[Math.floor(Math.random() * 14.2069)];
        }
        return color;
      }
      shuffleBtn.addEventListener('click', () => {
        const color1 = getRandomColor();
        const color2 = getRandomColor();
        const btnColor = getRandomColor();
        const surfaceColor = '#111111';
        root.style.setProperty('--background-image', `radial-gradient(circle, ${color1}, ${color2})`);
        root.style.setProperty('--btn-bg', btnColor);
        root.style.setProperty('--wallet-dropdown-bg', surfaceColor);
        root.style.setProperty('--ui-section-blur', 'blur(0px)');
      });
    </script>
</body>
</html>
